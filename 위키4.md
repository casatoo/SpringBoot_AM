## 2022.09.23
- 롬복 설치와 적용
- 스프링 부트 프로젝트 생성
    - 복습하면서 다시 만들어보자
    - Spring Starter Project
    - Maven Project, War
    - Lombok, Spring Boot DevTools, Spring Web4

- Controller 만들기
    - 컨트롤러 안에서 페이지 생성

    ```java
        @Controller
        public class UsrHomeController {
            @RequestMapping("/usr/home/main")
	        @ResponseBody
	        public String showMain() {
		    return "안녕하세요";
	        }
        }
    ```
    - @Controller 를 해주면 해당 클래스는 컨트롤러의 역할을 한다.
    - @RequestMapping("/usr/home/main") 로 경로를 지정

     ```java
        @Controller
        public class UsrHomeController {
	    int count;
	
	    public UsrHomeController(){
		count = 0;
	    }
	
        @RequestMapping("/usr/home/main")
        @ResponseBody
        public String showMain() {
            return "안녕하세요";
        }
        @RequestMapping("/usr/home/main2")
        @ResponseBody
        public String showMain2() {
            return "반갑습니다.";
        } 
        @RequestMapping("/usr/home/main3")
        @ResponseBody
        public String showMain3() {
            return "잘가요";
        }
        @RequestMapping("/usr/home/getCount")
        @ResponseBody
        public int showMain4() {
            return count++;
        }
        @RequestMapping("/usr/home/doSetCount")
        @ResponseBody
        public String doSetCount(int Count) {
            this.count = Count;
            return "카운트 값이 "+ count+"으로 초기화 됨";
            }
        }
    ```
    - 일반 자바 클래스 처럼 변수를 선언하고 페이지를 선언한 메서드 안에서 활용이 가능하다.
    - 메서드 인자로 받는 경우 페이지 주소에서 값을 받아올 수 있다.
    - /usr/home/doSetCount?Count=10 이렇게 하면 doSetCount 메서드에 int Count 값을 10으로 받아온다.
    - 리스트나 맵으로 값을 리턴할 수 도 있는데
    ```java
    @RequestMapping("/usr/home/getMap")
	@ResponseBody
	public Map getMap() {
		Map<String,Object> map = new HashMap<>();
		map.put("철수나이",22);
		map.put("영희나이",22);
		return map;
	}
	@RequestMapping("/usr/home/getList")
	@ResponseBody
	public List<String> getList() {
		List<String> list = new ArrayList<>();
		list.add("철수나이");
		list.add("영희나이");
		return list;
	}
    ```
    - 이렇게할경우 Map은{"철수나이":22,"영희나이":22} List는 ["철수나이","영희나이"] 이렇게 출력됨
    - @getter
    - @Data
    - @AllArgsConstructor 생성자를 만들어주는 어노테이션
    - @NOArgsConstructor 생성자를 만드는데 인자값은 없음
    - 객체를 만들어서 리스트에 담는 경우 Articles
    ```java
    @RequestMapping("usr/home/getArticle")
	@ResponseBody
	public Article getArticle() {
		Article article = new Article(1, "제목1");
		Article article2 = new Article();

		return article;
	}

	@RequestMapping("usr/home/getArticles")
	@ResponseBody
	public List<Article> getArticles() {
		Article article1 = new Article(1, "제목1");
		Article article2 = new Article(2, "제목2");

		List<Article> articles = new ArrayList<>();
		articles.add(article1);
		articles.add(article2);

		return articles;
	}
    @Data
    @NoArgsConstructor
    @AllArgsConstructor
    class Article {
	private int id;
	private String title;

    }
    ```
    - articles 는 [{"1","제목1"},{"2","제목2"}]
    - 값을 파라미터로 받아올때 & 로 구분하는거 잊지말자

## 2022.09.26

- 테스트 데이터 추가
- 리스트 기능 구현
- 삭제기능 구현 doDelete
    - id 값을 가져와서 동일 id 값의 글을 찾아야 함
        - article 가져오는 서비스 메서드 구현
        ```java
        private Article getArticle(int id){
            for(Article article : articles){
                if(article.getId()==id){
                    return article;
                }
            }
            return null;
        }
        ```
    - 배열에서 불러온 해당 article 삭제
    ```java
    private void deleteArticle(int id) {
    	Article article = getArticle(id);
    	
    	articles.remove(article);
    }
    @RequestMapping("/usr/article/doDelete")
	@ResponseBody
	public String doDelete(int id) {
		Article article = getArticle(id);
		if(article == null) {
			return id+"번 게시물은 존재하지 않습니다.";
		}
		deleteArticle(id);
		return id+"번 게시물을 삭제했습니다.";
	}
    ```
- 글 수정기능 구현
    - domodify
    - delete 참고
    - 수정할 title, body 는 파라미터로 받아옴
    - 글번호를 조회해서 가져오고 set 함수로 값 변경
    ```java
        Article article = getArticle(id);
    	
		article.setTitle(title);
		article.setBody(body);
    ```

- 글 상세보기
    - String 으로 묶어서 출력 했다..
    ```java
    @RequestMapping("/usr/article/detail")
	@ResponseBody
	public String showDetail(int id) {
		Article article = getArticle(id);
		if(article == null) {
			return id+"번 게시물은 존재하지 않습니다.";
		}
		String articleDetail ="";
		articleDetail += (article.getId()+"번 게시물 상세보기");
		articleDetail += ("제목: "+article.getTitle()+"\n");
		articleDetail += ("내용: "+article.getBody());
		
		return articleDetail;
	}
    ```
    - 이렇게 했었는데 object 객체로 변경하면 그냥 가능했다

    ``java
    @RequestMapping("/usr/article/detail")
	@ResponseBody
	public Object showDetail(int id) {
		Article article = getArticle(id);
		if(article == null) {
			return id+"번 게시물은 존재하지 않습니다.";
		}
		return article;
	}
    ```
- MVC
    - 모델, 뷰, 컨트롤러
    - 모델(model)
        - 로직, 영혼
    - 뷰(view)
        - 보이는부분 육체
    - 컨트롤러(controller)
        - 정신 모델과 뷰를 잇는다.
- Spring MVC
    - 모델, 뷰, 컨트롤러
    - 모델(model)
        - 서비스
        - 리포지터리
        - DB
    - 뷰(view)
        - JSP
        - JS
        - CSS
        - HTML
    - 컨트롤러(controller)
        - 컨트롤러
- 서비스 도입
    - @Service 생성
    - @Autowired 로 서비스와 컨트롤러를 연결시켜준다.
    ```java
    @Controller
    public class UsrArticleController {
	
	@Autowired
	private ArticleService articleservice;
    ```
    - 엑션 메소드가 아닌 일반 메소드들은 서비스로 넘겨준다.
    - 컨트롤러에서 일반 메소드의 작동은 articleservice.(메소드명) 으로 사용한다.
    - private 로 접근이 불가능한것은 public 으로 변경

## 2022.09.27
- 구조를 다시 살펴보자.
    - com.KMS.exam.demo 로 패키지가 생성 되었고
    - 그 안에 컨트롤러, 서비스, vo를 만들어주고
    - 컨트롤러에는 @Controller 를 써주고
    - 서비스에는 @Service 를 써준다.
    - vo에는 article 객체를 만들고 @Data 를 해서 안에 있는 인자를 사용할 수있게 했다. (getid, getTitle 등)
    - spring을 실행시키면 컨트롤러 맵핑된 주소의 메서드가 실행되고 메서드에서는 service가 처리해주는 것을 받아서 보여준다.

- 리포지터리 도입 (데이터 저장의 역할)
    - 서비스에서 가지고 있는 데이터를 여기다 넣고 여기서 서비스가 가져다 쓰는걸로? 해도 되는건가..
    - 구글링 해보자
    ```java
    @Component
    public class ArticleRepository {
    }
    ```
    ```java
    @Service
    public class ArticleService{
	
	@Autowired
	private ArticleRepository articleRepository;
	
	public ArticleService(ArticleRepository articleRepository) {
		this.articleRepository = articleRepository;
		articleRepository.makeTestData();
	}
    ```
    - 서비스 생성자에 리퍼지토리를 인자로 받아야 함

- 처음부터 다시 만들어보기
    - 스프링 부트 프로젝트 생성
    - 복습하면서 다시 만들어보자
    - Spring Starter Project
    - Maven Project, War
    - Lombok, Spring Boot DevTools, Spring Web
    - src/main/resources / application.properties 확장자명 변경
    - application.yml
    - article 관련 기능 생성
        - article vo 생성
            - @Data
            - @NoArgsConstructor (인자값 없는 생성자)
            - @AllArgsConstructor (인자갑 전부 받는 생성자)
        - article controller
            - controller 에서 맵핑
            - doAdd
            - getArticle
            - getArticles
            - doDelete
            - doModify
        - article service
        - article repository

- 데이터 베이스 연결
    - 의존성 추가(dependency)
    - maven 홈페이지 
    - mybatis spring boot starter
    - 2.2.2 들어가서 클릭하면 복사됨
    - pom.xml 에 dependency 에 붙여넣기
    - or 프로젝트 우클릭 - spring Add starters 에서
    - mybatis , mysql 커넥터 추가
    - application.yml 수정
        ```xml
        server:
            port: 8081
        spring:
            datasource:
            driver-class-name: jdbc:mysql://1.234.44.77:3306/SB_AM?useUnicode=true&characterEncoding=utf8&autoReconnect=true&serverTimezone=Asia/Seoul&useOldAliasMetadataBehavior=true&zeroDateTimeNehavior=convertToNull
        username: user1
        password: mkop9074!@
        mybatis:
            type-aliases-package: com.KMS.exam.demo.vo
        ```
    - repository 를 @Mapper 으로 변경
    - class 를 interface로 변경
    - 메소드 형식을 interface에 맞게 수정한다.
    - 퀴리문 실행은 어노테이션을 이용한다.
    ```java 
    @Select("SELECT * FROM article WHERE id = #{id}")
    public Article getArticle(int id);
    ```
    - 원래는 @Param 파라미터라고 알려줘야 됬었다고 한다.
    ```java
    public Article getArticle(@Param("id") int id);
    ```
    - LAST_INSERT_ID() 
    - 글 생성시에 리턴타입이 맞지않아 오류페이지가 출력되는 상황
        - LAST_INSERT_ID() 로 마지막 삽입, 수정된 글 번호 추출해서
        - select 문으로 불러와서 리턴
        - write 리턴타입 int 로 해서 리턴하고 service에서 getArticle 로 불러와서 리턴?
        - insert는 더이상 결과값을 가져오지 않으므로 void로 해줘야 한다.

    - doModify 에서 글 수정시에 예전값을 가져오는것도 수정이 필요하다.


## 2022.09.28

- articlerepository.xml 작성
    - 리포지토리와 xml 의 연동
        - namespase로 리포지토리를 연동하고
        - 쿼리문을 각각 저장한다.
        - return 은 resultType 으로 vo 안에 있는 객체 이름을 적어준다.
        - int 타입은 생략 가능
        - application.yml 에서 마이바티스로 설정한 vo 주소가 여기에서 주소를 줄여주는 역할을 해준다.
        - 원래 리포지토리에서 작성된 쿼리는 지운다.

        ```xml
        <?xml version="1.0" encoding="UTF-8" ?>
        <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

        <mapper namespace="com.KMS.exam.demo.repository">
        <insert id="writeArticle">
        INSERT INTO article 
        SET regDate = NOW(), 
        updateDate = NOW(), 
        title = #{title},
        `body` = #{body}
        </insert>
        <select id="getArticle" resultType="Article">
        SELECT * FROM article 
        WHERE id = #{id}
        </select>
        <select id="getArticles" resultType="Article">
        SELECT * FROM article 
        ORDER BY id DESC
        </select>
        <delete id="deleteArticle">
        DELETE FROM article 
        WHERE id = #{id}
        </delete>
        <update id="modifyArticle">
        UPDATE article SET 
        title = #{title}, 
        `body` = #{body}, 
        updateDate = NOW() 
        WHERE id = #{id}
        </update>
        <select id="getLastInsertId">
        SELECT LAST_INSERT_ID()
        </select>
        </mapper>
        ```

    - 입력된 정보만 수정될 수 있도록 작업
        - modify에서 제목이나 내용이 입력되지않을 경우 입력값이 전달되지 않아 오류가 발생하는 문제를 해결
        - mybatis 공식 사이트에서 검색
        - 조건식에 따른 쿼리 실행으로 값을 SET 할 수 있다.
        ```xml
        <update id="modifyArticle">
		UPDATE article
		<set>
			<if test="title != null and title !=''">title = #{title},</if>
			<if test="body != null and body !=''">`body` = #{body},</if>
			updateDate = NOW()
		</set>
		WHERE id = #{id}
	    </update>
        ```

    - tailwindcss
        - css 라이브러리
        - (치트시트)[https://nerdcave.com/tailwind-cheat-sheet]
    
    - memberController 만들기
        - usr/member/dojoin
            - loginId
            - loginPw
            - name
            - nickName
            - cellphoneNum
            - email
        1. member 테이블 생성 (comment에 대해서 알아볼것.)
        ```sql
        CREATE TABLE `member`(
        id INT(10) AUTO_INCREMENT NOT NULL PRIMARY KEY,
        regDate DATETIME NOT NULL,
        updateDate DATETIME NOT NULL,
        loginId VARCHAR(20) NOT NULL,
        loginPw VARCHAR(20) NOT NULL,
        `authLevel` SMALLINT(2) UNSIGNED DEFAULT 3 COMMENT '권한 레벨 (3=일반,7=관리자)',
        `name` VARCHAR(20) NOT NULL,
        nickname VARCHAR(20) NOT NULL,
        cellphoneNum VARCHAR(20) NOT NULL,
        email VARCHAR(50) NOT NULL,
        delStatus TINYINT(1) UNSIGNED NOT NULL DEFAULT 0 COMMENT '탈퇴여부 (0=탈퇴 전, 1= 탈퇴 후)',
        delDate DATETIME COMMENT '탈퇴날짜'
        );
        ```
        2. 관리자 계정 생성
        3. memberRepository.xml 생성, 쿼리 작성
        4. 글생성과 비슷한 방법으로 가입하고 마지막 insert된 정보를 받아서 가입인사 출력

## 2022.09.29

- 남아있는 작업
    - 회원 가입 시 아이디 중복 체크
        - 중복된 아이디의 경우 이미가입된 아이디 메세지 출력
        - 입력된 loginId로 데이터베이스 확인
        - count(*)
        - 1 이면 중복 0 이면 통과
        - xml파일에서 resultType 을 지정하지 않으면 오류가 발생하니 주의
    - 글 작성자 컬럼 추가
        - 데이터베이스 컬럼 추가
        - 테스트 데이터에 작성자 id 추가
        - vo article에 작성자 추가
    - 로그인 기능 추가
        - 로그인 할때 id 체크
            - 회원가입때 사용한거 다시 활용
        - 비밀번호 체크
            - id 가 확인된 상태이기 때문에 loginId 를 통해  PW 를 가져오는 쿼리를 작성
        
    - 로그아웃 기능 추가
    - 글 수정, 삭제 권한

    - 입력값 누락시 메세지 출력
        - 입력값을 확인하는 유효성 검사
        - util 생성 후 체크
        ```java
        public static boolean checkStr(Object obj) {
		if(obj == null) {
			return true;
		}
		if(obj instanceof String == false) {
			return true;
		}
		String str = (String) obj;
		
		
		return str.trim().length() == 0;
	    }
        ```
    - 회원가입시에 이름과+이메일이 일치하는 경우 중복
        - 이미 가입된 회원입니다 를 표시하자
        
    - printf(%d %s , ) 양식으로 출력해보기
        ```java
        public static String f(String format, Object... args){
            return String.format(format,args);
        }
        ```
    - 규칙 정하기
        - 데이터의 입력과 출력에서 규칙을 정해놔야 햇갈리지않는다.
        - 예를들어 -1, -2, 1, 등등

## 2022.09.30

- 세션 저장해서 글 작성시 글작성자 넣기
    ```java
	@RequestMapping("/usr/member/doLogin")
	@ResponseBody
	public String doLogin(String loginId, String loginPw, HttpServletRequest request) {
		if(ut.checkStr(loginId)) {
			return "아이디를 입력해주세요";
		}
		if(ut.checkStr(loginPw)) {
			return "비밀번호를 입력해주세요";
		}
		int doLogin= memberService.doLogin(loginId,loginPw);
		if(doLogin == -1) {
			return "존재하지 않는 아이디 입니다.";
		}
		if(doLogin == -2) {
			return "잘못된 비밀번호 입니다.";
		}
		Member member = memberService.getMemberByLoginId(loginId);
		HttpSession session = request.getSession();
		session.setAttribute("loginedId",member.getId());
		
		
		return member.getName()+"님 환영합니다.";
	}
    ```
    - request 받아올수 있게 추가
    - 세션 만들고 값 세팅

    - ariticle 컨트롤러에서 세션 불러와서 글 작성할때 인자값으로 넣어보자
    - article 테이블부터, 쿼리문, vo, 리포지토리, 서비스, 컨트롤러 순으로 수정
    ```java
    @RequestMapping("/usr/article/doAdd")
	@ResponseBody
	public Article doAdd(String title, String body ,HttpServletRequest request) {
		
		HttpSession session = request.getSession();
		int loginedId = (int) session.getAttribute("loginedId");
		
		int id = articleService.writeArticle(title, body, loginedId);

		Article article = articleService.getArticle(id);

		return article;
	}
    ```
- 보고서 양식 이어서 만들기
    ```java
    public class ResultData {
	
	@Getter
	private String resultCode;
	
	@Getter
	private String msg;
	
	@Getter
	private Object data1;

	private ResultData() {

	}
	
	public static ResultData from(String resultCode, String msg) {
		return from(resultCode, msg, null);
	}

	public static ResultData from(String resultCode, String msg, Object data1) {
		ResultData rd = new ResultData();
		rd.resultCode = resultCode;
		rd.msg = msg;
		rd.data1 = data1;

		return rd;
	}

	public boolean isSuccess() {
		return resultCode.startsWith("S-");
	}

	public boolean isFail() {
		return isSuccess() == false;
	}

    }
    ```
    - 리턴 형식 "S-1" 은 성공 "F-1"은 실패
    - msg = 성공 또는 실패시 출력 메세지
    - data1은 가져오는 데이터가 있는 경우
    - isSuccess() 는 참, 거짓으로 S- 로 시작하면 성공
    - isFail() 도 참, 거짓으로 isSuccess()가 false로 나오면 true
    - 성공 또는 실패 메세지가 나와야 하는 부분에 적용
    - 오류 발생시 내부 코드가 보여지는것을 막기 위함

- newData 메서드 생성
    ```java
    public static <DT> ResultData<DT> newData(ResultData joinRd, DT newData) {
	return from(joinRd.getResultCode(), joinRd.getMsg(), newData);
	}
    ```
    - 새 글 작성, 회원가입 에서 서비스에서 가져온 결과값과 새로운 데이터 값을 넣고
    - 가져온 결과값에서 resultcode와 msg , 새로운 데이터 값을 리턴

- 제너릭 도입 (K , V , T , DT) 등등
    - 관습이라 안해줘도 됨
    - 클래스 외부에서 타입을 정해준다.
    - 제네릭 클래스, 제네릭 메소드 등
    - class 클래스이름<제너릭>{
        제너릭 변수이름 ; 
    
    - 사용할때 ArrayList 처럼 뒤에 <제너릭>() 가 된다.
    - Object 타입으로 가져오는 data1 을 DT 로 바꿔준다.

## 2022.10.04
- 로그인 로그아웃 기능 구현
- 저장했던게 날라갔음...
```java
public ResultData<Member> doLogin(String loginId, String loginPw, HttpServletRequest request) {
		
	int loginedId = Ut.getLoginedId(request);
		
	if(loginedId != 0) {
		return ResultData.from("F-1", Ut.f("이미 로그인중입니다."));
	}
		
	if(Ut.empty(loginId)) {
		return ResultData.from("F-2", Ut.f("아이디를 입력해주세요"));
	}
	if(Ut.empty(loginPw)) {
		return ResultData.from("F-3", Ut.f("비밀번호를 입력해주세요"));
	}
	ResultData doLoginRd= memberService.doLogin(loginId,loginPw);
	if(doLoginRd.isFail()) {
		return ResultData.from(doLoginRd.getResultCode(),doLoginRd.getMsg());
	}
	Member member = memberService.getMemberByLoginId(loginId);
	HttpSession session = request.getSession();
	session.setAttribute("loginedId",member.getId());
		
	return ResultData.from("S-1",Ut.f("%s 회원님 환영합니다.",member.getName()),member);
	}
```
- Session 클래스를 만들어서 생성자로 세션값을 저장하고 필요할때 불러오자
- Session.loginId 를 불러올때는 null 값일때는 0을 반환

- 수정, 삭제 권한 부여
```java
    int loginedId = Session.getLoginedId(request);
    Member member = memberService.getMember(loginedId);
	int loginedLevel = member.getAuthLevel();
		
	if(loginedId != article.getLoginedId() &&  loginedLevel != 7) {
		return ResultData.from("F-3", Ut.f("권한이 없습니다."));
	}
```
- 로그인한 맴버의 id 와 권한 레벨을 가져와서 게시글의 작성자와 일치하는지, 그리고 관리자 권한이 있는지 비교하고 아니라면 권한이 없음을 출력
- SessionController 클래스 지정해서 따로 기능 정리
- json viewer 설치

## 2022.10.05
- 복습
    - Spring boot 프로그램 만들기
        - Lombok 등 필요한 요소들 확인
    - Controller 생성
        - @Controller 어노테이션
        - @RequestMapping("주소") 로 주소값 입력 요청
        - @ResponseBody 로 응답 @RestController 도 같은 역할 할 수 있는거같다.
        - @Autowired 로 인스턴스 변수 생성 서비스와 연결
    - Service 생성
        - 구조를 파악해야 한다.
        - controller -> 접수원
        - service -> 접수원이 요청한 것을 창고 관리자에게 가져다 달라고 부탁
        - Repository -> 창고에서 자료를 찾아오는 사람
        - @Service  어노테이션
        - @Autowired 로 인스턴스 변수 생성 리포지토리와 연결
    - Repository 생성
        - @Mapper 어노테이션
        - 마이바티스를 사용해서 XML 로 보기 좋게 만들 수 있음
        - 아닌 경우에는 어노테이션을 사용해 쿼리를 작성해야 함
        - @Select("SELECT LAST_INSERT_ID()") 이런식으로
        - MyBatis 설치와 적용은 복습이 필요하다.
    - Vo 생성
        - Article , Member 클래스 생성
        - @Data 가지고있는 요소를 get 으로 가져올 수 있도록 함
        - @NoArgsConstructor 생성자 . 요소 없이 생성됨
        - @AllArgsConstructor 생성자 . 요소가 전부 포함됨
    - 데이터 테이블 생성
        - Mysql에서 데이터 베이스 생성
        - 요소값들을 쿼리에 적용
    - Ut 생성
        - 중복요소의 제거를 해나가야 한다.
        - 입력되는 요소의 유효성 검사를 위한 메서드 생성
        - 입력되지 않았거나 공백으로 입력되는 경우 등등
        - String 출력 양식을 printf 처럼 적용해줄 메서드도 생성
        ```java
        public static String f(String format, Object... args){
        return String.format(format,args);
        }
        ```
        - Object... 은 인자값을 받는 갯수가 일정하지 않을때 사용
    - ResultData 생성
        - 결과값을 내보낼때 일정한 규칙에 의해 구분할 수 있도록 규칙을 생성
        - 보고서 양식
        - 요청에 성공했을때, 실패했을떄의 결과 코드와 메세지 그리고 출력해야되는 data 를 입력받아서 정해진 양식에 따라 출력 될 수 있도록 함.
        - 컨트롤러, 서비스에서 요청에 따른 결과를 보여주어야 할때 사용
        - 제네릭 생성
            - 데이터 타입을 지정해 주어 입력값과 출력값에 대한 오류를 줄일 수 있음
    - Session 관리
        - 로그인, 로그아웃, 권한에 관한 주의
        - HttpSession 으로 set하고 get 해줄 수 있다.
    - README 작성
        - 사용한 요소들의 종류와 버전을 기록해 놓자.
    - 리엑트는 따로 연결해보자
        -[리엑트 연결 참고](https://gyoogle.dev/blog/web-knowledge/react-knowledge/React%20&%20Spring%20Boot%20%EC%97%B0%EB%8F%99%ED%95%98%EC%97%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0.html)


- 권한 체크
- 보고서 작성 규칙 개선
    - data1 의 이름을 생성
    - 리턴되는 데이터의 형식이 어떤것인지 표시한다.


- sql 로거 적용
    - 데이터 베이스에 접속하여 데이터를 가져올때 sql 로거를 거쳐서 기록을 남기도록 한다.
    - [참고](https://freehoon.tistory.com/113)

- spring jsp 엔진
    - 의존성 추가
    - prefix, surfix 추가
    - jps 연동
    - @responsebody 삭제
    - return "jps 경로" 로 수정
    - Model 객체를 사용해서 jsp 로 key, value 값으로 전달
    - jsp 파일에서 ${value} 로 값 불러오기
    
## 2022.10.06

- 눈누에서 폰트 적용하기
    ```css
    @font-face {
        font-family: 'GangwonEduPowerExtraBoldA';
        src:
            url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2201-2@1.0/GangwonEduPowerExtraBoldA.woff')
            format('woff');
        font-weight: normal;
        font-style: normal;
    }

    html>body {
	    font-family: 'GangwonEduPowerExtraBoldA';
    }
    ```

- head.jspf, foot-jspf 적용
    ```jsp
    <%@ include file="../common/head.jspf" %>
    <%@ include file="../common/foot.jspf" %>
    ```
    - 각 페이지 이름 변경해서 보여주기
    ```jsp
    <%-- 각 페이지에서 지정 --%>
    <c:set var="pageTitle" value="ARTICLE DETAIL"/>
    <%-- head.jspf 에서 받아오는 법 --%>
    <title>${pageTitle} PAGE</title>
    ```

- 테일윈드 css 적용
    - tailwind cheat sheet
    - tailwind jit cdn

    ```jsp
    <%-- 제이쿼리 --%>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <%-- 테일윈드 불러오기 --%> 
    <script src="https://unpkg.com/tailwindcss-jit-cdn"></script>

    <%-- 폰트 어썸 --%>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <%-- common.js --%>
    <script src="/resource/common.js" defer="defer"></script>
    ```

- detail 페이지 추가
    - 리스트 에서 약간 수정
        - aritcle 형태로 받아와서 구현
    - 테이블 구현
    - 버튼 추가
        - 뒤로가기
        - history.back();

- 구현해야 하는 것.
    - 로그인 하고 환영 메세지 출력 메인페이지로 이동
    - 디테일 페이지 꾸미기
    - 기능을 jsp 로 구현하자
        - 회원가입 폼 만들기
        - 글 수정 버튼 구현
        - 글 삭제 버튼 구현
        - 글 수정 페이지 폼 만들기
        - 글 작성 폼 만들기

- 글 리스트에서 작성지 이름으로 나오게
    - 리스트 폼은 다시 만들어야함 지저분.
    - inner join 으로 이름까지 불러와서 해결

- 로그인 기능 구현
    - 로그인 성공, 이미 로그인되있을 때 메인페이지로
    - 로그인 실패, 미입력시 로그인폼으로
    - 결과값을 반환해서 msg로 알림뜨게 함.
    - 로그인 했을 때 로그인한 사람의 이름이 나오게 head.jspf 수정
    
- 회원가입 폼 만들기
    - 로그인 폼 참고
    - 입력값이 많음으로 각 항목당 입력타입을 알아보자
    - 6가지 입력

## 2022.10.07
- 권한의 구현
    - 작성자 권한 구현으로  서비스 단에서 메소드를 구현해서 controller에 제공
    -                                                                  
    - 내 프로젝트에 전체적으로 리펙토링이 필요.. 중복을 제거하는 쪽으로

- form 으로 연결해서 동작을 주고받을떄 내가 했던 방법대로 해도 좋은지..
- 가끔 로그인 상태인데 로그아웃된 레이아웃이 나온다.
- 리스트로 돌아갈때 articles 의 정보를 주지 않으면 나오지 않는것도 문제..

## 2022.10.11
- 복습
    - 스프링 마이크로 서비스 코딩 공작소 // 스프링 부트 책

- 게시물 삭제 뒤로가기 경로 설정
    ```java
    public static String jsHistoryBack(String msg) {
        if (msg == null) {
            msg = "";
        }
        return Ut.f("""
            <script>
            const msg = '%s'.trim();
            if (msg.length > 0){
                alert(msg);
            }
            history.back();
            </script>
            """, msg);
    }
	public static String jsReplace(String msg, String uri) {
        if (msg == null) {
			msg = "";
		}

		if (uri == null) {
			uri = "";
		}
        return Ut.f("""
			<script>
			const msg = '%s'.trim();
			if (msg.length > 0){
				alert(msg);
			}
			location.replace('%s')
			</script>
			""", msg, uri);
	}
    ```
    -  스크립트 문을 삽입
    ```java
    if (rq.isLogined() == false) {
		return Ut.jsHistoryBack("로그인 후 이용해주세요");
	}
	Article article = articleService.getForPrintArticle(rq.getLoginedMemberId(), id);
	if (article == null) {
        return Ut.jsHistoryBack(Ut.f("%d번 게시물은 존재하지 않습니다", id));
	}
	if (article.getMemberId() != rq.getLoginedMemberId()) {
		return Ut.jsHistoryBack(Ut.f("%d번 게시물에 대한 권한이 없습니다.", id));
	}
	articleService.deleteArticle(id);
	return Ut.jsReplace(Ut.f("%d번 게시물을 삭제했습니다", id), "../article/list");
    ```
    - controller 부분에서는 msg, replace 주소 를 리턴
    ```html
    <c:if test="${article.extra__actorCanDelete }">
		<a class="btn-text-link" onclick="if(confirm('정말 삭제하시겠습니까?') == false) return false;"
	        href="../article/doDelete?id=${article.id }"
		>삭제</a>
	</c:if>
    ```
    - 버튼이 클릭 되면 지정된 주소로 이동 ../article/doDelete?id=${article.id }
    - 컨트롤러의 삭제 명령이 실행됨
    - 결과값이 스크립트 형식으로 return 되면서 경고창, 주소 이동됨.

- 로그인 확인에 대한 중복 방지
    - rq 도입
    ```java
    public class Rq {
        @Getter
        private boolean isLogined;
        @Getter
        private int loginedMemberId;
        public Rq(HttpServletRequest req) {
            HttpSession httpSession = req.getSession();
            boolean isLogined = false;
            int loginedMemberId = 0;
            if (httpSession.getAttribute("loginedMemberId") != null) {
                isLogined = true;
                loginedMemberId = (int) httpSession.getAttribute("loginedMemberId");
            }
            this.isLogined = isLogined;
            this.loginedMemberId = loginedMemberId;
        }
    }
    ```

- 인터셉터 구현
    - Interceptor는 낚아채다의 의미를 가지고있다.
    - Client에서 Server로 들어온 Request 객체를,
    - Controller의 Handler로 도달하기 전 가로채어,
    - 원하는 추가 작업이나 로직을 수행 한 후 Handler로 보낼 수 있도록 해주는 Module이다.
    - Handler : 사용자가 요청한 url에 따라 실행되어야 할 Method

    ```java
    @Component
    public class BeforeActionInterceptor implements HandlerInterceptor {

	@Override
	public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {
		System.out.println("실행됨?");
		return HandlerInterceptor.super.preHandle(req, resp, handler);
	}
    }
    ```

    - WebMvcConfigurer 클래스 생성
    - implements WebMvcConfigurer 해주고
    - @Autowired 해서 BeforeActionInterceptor 생성
    - 인터셉터 적용
    ```java
    // /resource/common.css
	// 인터셉터 적용
	public void addInterceptors(InterceptorRegistry registry) {
		registry.addInterceptor(beforeActionInterceptor).addPathPatterns("/**").excludePathPatterns("/resource/**").excludePathPatterns("/error");
    }
    ```
    - 실행 로그에 인터셉터가 실행되는 모습을 보인다.
    - 이건 원리를 다시 알아봐야 할거같다.
    - Hendler 가 뭔지..
    - 인터셉터 부분에서 로그인 확인에 대한 중복방지로 도입한 rq 객체를 생성하도록 해서 필요한곳에 가져다 쓸 수 있도록 한다.
    - 각각의 메서드에서 새로 만들어주는 객체를 인터셉터의 기능으로 하나만 만들어서 가져다 쓰는 방법이다.  ( 싱글톤 패턴? )
    ```java
    @Override
	public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {

		Rq rq = new Rq(req);
		req.setAttribute("rq", rq);

		return HandlerInterceptor.super.preHandle(req, resp, handler);
	}
    ```
- NeedLoginInterceptor 구현
    - 로그인 체크를 미리 하도록

## 2022.10.12
- 세션 컨트롤 없애고 새 방식 도입 중 ..
- 바꿔줄게 너무 많아서 일부 변경 후 점차 변경할 예정
- 어제 도입한것
    - historyBack
    - replace
    - interceptor
        - webMvcConfigurer
            - 인터셉터를 적용한다.
        ```java
        @Override
	    public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {

		Rq rq = new Rq(req);
		req.setAttribute("rq", rq);

		return HandlerInterceptor.super.preHandle(req, resp, handler);
	    }
        ```
        - 동작하는 부분
    - 할 수 있는것은..
        - 로그인상태임을 알 수 있는것.
        - 주소를 이동해야할때 리턴타입으로 줄수 있는것.
        - 페이지도 수정이 필요하다.
            - header.jspf 수정을 우선.한다.
    
-  NeedLoginInterceptor
    - NeedLoginInterceptor 파일 생성
    - MyWebMvcConfigurer 에서 인터셉터 적용
        - 로그인이 필요한 기능을 레지스트리로 등록
        ```java
        registry.addInterceptor(needLoginInterceptor)
				.addPathPatterns("/usr/article/doAdd")
				.addPathPatterns("/usr/article/write")
				.addPathPatterns("/usr/article/modify")
				.addPathPatterns("/usr/article/doModify")
				.addPathPatterns("/usr/article/doDelete")
				.addPathPatterns("/usr/member/doLogout");
        ```
    ```java
    Rq rq = (Rq) req.getAttribute("rq");
		
	if (!rq.isLogined()) {
    //	resp.getWriter().append("<script>")...

	    rq.printHistoryBackJs("로그인 후 이용해주세요");
		return false;
	}
    ```
    - HttpServletResponse 로 getWriter().append() 처럼 보내면 된다.
    - 로그인필요 메세지 말고 다른데 쓰일 가능성이 있음으로 문장만 입력하면  getWriter().append() 이런걸 쓰지 않아도 되게  함수로 만들어 준다.
    ```java
    public void printHistoryBackJs(String msg) throws IOException {
		resp.setContentType("text/html; charset=UTF-8");

		println("<script>");

		if (!Ut.empty(msg)) {
			println("alert('" + msg + "');");
		}

		println("history.back()");
		println("</script>");
	}

	public void print(String str) {
		try {
			resp.getWriter().append(str);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	public void println(String str) {
		print(str + "\n");
	}
    ```
- 글 수정 기능 구현
- 로그인 로그아웃 기능 수정

## 2022.10.13
- 로그인 상태에 따른 버튼 노출 제어
    - 현재 완료되있는것.
        - 로그인 했을때 로그아웃 버튼
        - 로그아웃상태에서 로그인, 회원가입 버튼
        - detail 에서 작성자 만 수정,삭제 버튼
    - 추가
        - 로그인 상태에서 글 작성 보이게

- 로고 가져오기
    - 폰트어썸
    - cdnjs 에서 폰트어썸 링크태그 복사 붙여넣기
    - 폰트어썸에서 아이콘 링크 복사 붙여넣기

- 실행 구조
    - 컨피규레이터에 설정된 인터셉터는 스피링 실행과 동시에 1회 실행됨
    - 어플리케이션yml 은 무거운 방식
    - spring bean 알아보기 / autowried 로 생성하는 자바 객체를 bean
    - 어노테이션으로 bean을 쉽게 생성한다.

- modify 에 대한 권한 체크
    - jsp 파일 생성으로 권한이 없을 경우 알림창과 뒤로가기가 되는 명령 수행

## 2022.10.14

- tailwind
    - daisy ui 로  페이지 수정
- 글 작성
- 리스트 분리
    - 공지사항
    - 자유게시판
    - 테이블 수정
        - board 테이블 생성
            - 테이블 정보 테이블
        - article 수정
            - boardId 추가
    - 상단 공지사항, 자유게시판, 전체 글보기로 메뉴 수정
    - 각 페이지마다 다른 리스트 출력
    - 페이지 이름 또한 각각 적용

    1. 상단 메뉴 추가
    2. 쿼리문 작성
        - boardId = 조건 추가
        - boardId = 값을 controller에서 넘겨주고 해당되는 데이터를 가져올 수 있도록한다.
        - 공지사항은 = 1, 자유게시판은 =2 전체글 목록은 *? 
    
## 2022.10.16
    - 리스트 페이지 하나로 구현
    - 파라미터 값을 받아서 글 목록을 가져옴
    - 쿼리는 두개로 나눠짐
    - 글 작성시 위치한 페이지에 따라 공지사항, 자유게시판으로 변경
    - nav에 각각 리스트 버튼 구현
    - 아직 개수가 많지않아 괜찮지만 2차 리스트로 나오게 변경해야함
    - 게시물 페이징 해야함

## 2022.10.16
    - 페이징 처리
        - 페이지 수를 가져오는 쿼리를 짜야함
        - 기존꺼 쓰면서 * 대신 count(*) 하면 숫자를 반환 받으니까
        - 페이지 수는 가져온 conut 에서 나누기10 하고 올림처리 하면 페이지 수가 된다.
        - 리스트에서 페이지 수만큼의 버튼을 생성
        - 반복문으로 만들고 내부 값을 usr/article/list?boardId=?&page=? 처럼 인자값 전송
        - 불러올때 이제 반복문을 전체 돌리는게 아닌 10번으로 제한하고 articles 의 List에서 특정 순번을 호출 할 수 있도록 조정

## 2022.10.18
    - 자습
        - 페이징 처리
        - 이전에 계속 했던 방법으로 10개씩 잘라서 가져오는 방식
        - LIMIT 0,10 = 0부터 10개 , 10,10  하면 10부터 10개씩 가져올 수 있다.
        - 토탈 페이지 갯수는 count() 로 받는 쿼리를 따로 리포지토리로 만들었다.
        - 추가로 해야할것.
            - 10페이지가 넘어가는 경우 클릭하는 페이지를 옆으로 넘길 수 있는 방식 필요

        - c:if 로 보여주는 버튼을 다르게 표시하기 
            - ex) 1~10 까지는 1~10 옆으로 넘기는 버튼을 누르면 11부터20까지 보여주도록
            - forEach 로 begin end 설정
            - 


- rq 객체 삭제
- 서블릿 리퀘스트도 삭제
```java
@Component
@Scope(value = "request", proxyMode=ScopedProxyMode.TARGET_CLASS)
public class Rq {

    // 생성자 안에 선언
    this.req.setAttribute("rq", this);
```
- 다른 클래스에 Autowried 로 가져옴
```java
	@Autowired
	private Rq rq;
```
- BeforeActionInterceptor , NeedLoginInterceptor 에도 선언
```java
	@Autowired
	private Rq rq;
	
	@Override
	public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {
		
		rq.initOnBeforeActionInterceptor();

		return HandlerInterceptor.super.preHandle(req, resp, handler);
	}
```
- BeforeActionInterceptor 에서는 rq의 빈 메소드를 호출해서 값을 가져오게함
```java
	public void initOnBeforeActionInterceptor() {
		
	}
```
- 게시판 선택은 Select 로 만듬
    - 선택 안할때 오류가 나서 doAdd에 historyback 하나 선언해줌
```java
if(Ut.empty(boardId)) {
	return Ut.jsHistoryBack(Ut.f("게시판을 선택해주세요"));
}
```
- 검색기능
    - form 으로 감싸서 summit 하면 동작
    - search 기능 추가
        - 쿼리 select Like %포함된 문자열% 해서 검색하도록
- ajax 검색

## 2022.10.19
- 글 검색기능
    - form 으로 감싸서 boardId 와 search 값을 넘김
    - 어차피 검색하면1페이지부터 나와야 하니까 page는 안넘김 기본 1로 설정
    - 컨트롤러에 기본값 설정
        - 아무것도 검색하지 않을 경우에 "" 으로 
        - 검색어 앞뒤로 % 붙여서 쿼리에 보냄
        ```java
        String searchItem = "%" + search.concat("%");
        ```
    - sql 수정
        - AND A.title LIKE #{search}
        - LIKE 로 검색
        - 가져오는 문자열이 %% 만 남아있지 않는다면 검색 if 문 추가

- 페이지 버튼 수 제한
    ```js
    <c:set var="pageMenuLen" value="4" />
	<c:set var="startPage" value="${page-pageMenuLen >=1 ? page-pageMenuLen : 1}" />
	<c:set var="endPage" value="${page + pageMenuLen <= pageCount ? page + pageMenuLen : pageCount}" />
    <c:forEach var="pageNum" begin="${startPage}" end="${endPage}">
		<button class="btn btn-sm ${page == pageNum ? 'btn-active' : '' }" onclick="location.href='../article/list?boardId=${boardId}&page=${pageNum}';">${pageNum}</button>
	</c:forEach>
    ```
    - 처음, 끝, 간격 변수를 지정해서 현재 페이지와 계산, 변수를 통해 페이지를 표현

- 글 검색기능 추가
    - 제목 검색, 글쓴이 검색 등 다양하게 하는걸로 해보자.
    - 조건식에 변수를 #{} 형식으로 하니 ""가 붙어서 검색이 안된다.
    - ${} 로 표시해서 해결
    - 쿼리에서 % 되도록 조정해주자
    - 조건입력안했을때 제목, 내용을 검색하도록 조정해야함.
        - AND(조건 OR 조건)?


- 페이지 수가 전체 페이지가 아니라 조건에 따른 페이지 수  검색이 이루어져야 함.
    - total페이지를 불러오는 쿼리를 조정
    - 검색결과에서 count 하고 limit 를 없앴음

- 검색 후 페이지 이동시 검색조건이 초기화 되는 현상
    - 검색조건을 다시 페이지로 해서 계속 유지
    - model.addAttribute("searchFrom",searchFrom);
	- model.addAttribute("searchWord",searchWord);


## 2022.10.20

- 조회수 기능 추가
    - article vo 에 hit 추가
    - 지금까지 글은 hit이 0 으로 설정
    - 디폴트로 0 으로 생성
    - 글 작성은 그대로 둬도 디폴트가 0 이기때문에 상관없음
    - 조회 즉 detail 영역에서 hit을 1증가시켜 저장시킨다.
        - 보여지는건 증가시킨 이후 값을 출력
        - list 와 detail JSP파일도 수정
    - 조회수 증가를 ResultData 로 가져오기
    - 조회수 증가 기능 분리
    - 

- ajax ?
    - 

- 남은 구현 기능
    - 댓글 작성
        - 댓글은 내용만으로 충분
        - 테이블 구조는 어느 글에 어떤 내용인지 작성 일시 만 알면 되지않을까.
        - repl 테이블 set 글ID, 내용
        - 글ID 는 글이 삭제되는 경우 행이 연쇄삭제가 되어야 함으로 cascade 를 써준다.
        - 글을 작성해서 나타내주는 뷰, 작성된 내용을 저장하는 컨트롤러, 호출해서 보여주는 뷰

## 2022.10.21
- 게시물 조회수 증가를 ajax로 해서 비동기 방식으로
- 중복조회를 막기위한 localStorage 도입
```jsp
<script>
	const params = {};
	params.id = parseInt('${param.id}');
</script>

<script>
console.log(localStorage);
</script>

<script>
	if(localStorage.getItem(${param.id}) != ${rq.loginedMemberId}){
	function ArticleDetail__increaseHit() {
		$.get('../article/incresedHit', {
			id : params.id,
			ajaxMode : 'Y'
		}, function(data) {
			$('.article-detail__hit').empty().html(data.data1);
		}, 'json');
	}
	$(function() {
		// 실전코드
		//ArticleDetail__increaseHitCount();
		// 연습코드
		setTimeout(ArticleDetail__increaseHit, 2000);
	})
	localStorage.setItem(${param.id}, ${rq.loginedMemberId});
	}
</script>
```

## 2022.10.24
- 좋아요 싫어요 기능 추가
    - 좋아요, 싫어요 버튼 추가
    - onclick= 컨트롤러에서 조회수 증가처럼 추가
    - 중복방지를 위해 memberId 값을 같이 받고
    - 로그인 하지 않았을 때 로그인 후 사용 가능하다는 메세지 출력
    - 좋아요 , 싫어요 메세지 출력 후 다시 디테일 페이지로 이동
- 리엑션포인트 테이블 생성
    - id, 날짜, 업데이트, 
    - 서브쿼리 & 조인 방법 생각해보기
    

## 2022.10.25
- 좋아요 싫어요 버튼 눌렀을때 작동되게 쿼리 짜기
    - 받아오는 파라미터 값 ( 글 번호, 회원번호, 좋다 or 싫다 )
    - 같은글에 한번 추천한 회원은 다시 추천하지 못하도록 조건 추가
- todo
    - 좋아요 싫어요 노출 관련 작업
    - 좋아요 싫어요 표현 할 수 있는 버튼 작업
    - 사용자가 1-2를 할 수 있는지 체크
    - 실제 버튼으로 컨트롤 할 수 있게 작업
    - 위 사항을 취소할 수 있는 작업
    
- 댓글 개념 추가 
    - 
    
## 2022.10.26
    - 좋아요 싫어요
        - 요구사항
            - 좋아요와 싫어요는 개별로 표현되도록 한다 .
            - 싫어요가 - 로 표시되게 하지 않고 그냥 일반 카운트로 샌다. 
            - 해당 게시물에 추천을 한 경우에는 버튼에 색을 입힌다.
            - 이미 표현을 한 게시물에 대해서는 재실행시 취소가 되도록 만든다.
            - 취소했을때는 색을 다시 원상태로 복구한다.
            - 비동기로 작동해야하는가...
        
        - 기능설계
            - 디테일부분에서 페이지에 표시되어야 하는 요소
                - 게시물을 보는 유저가 추천 또는 비추천 했는지 (버튼으로 표시)
                    - controller 에서 서비스로 요청 보내고
                    - 서비스에서 리포지토리로 요청보냄
                    - select * from reactionPoint where memberId = #{memberId}
                    - 값을 받아와서 point 를 조회
                    - vo 에서 reactionPoint 에대한 객체 정보 생성
                    - modelSetAttribute 로 보내줌
                    - <c:set var="goodReactionRd" value="${reactionRd == 1 ? '' : 'btn-outline'}"/>
                    - <c:set var="badReactionRd" value="${reactionRd == -1 ? '' : 'btn-outline'}"/>
                    - 삼항연산자를 통해 지금 로그인한 회원이 어떤 리엑션을 했는지에 따라 버튼에 class를 적용
                - 로그인 했을떄만 작동
                    - NeedLoginAction 인터셉터로 로그인 필요 메세지를 출력
            - 클릭했을 때 구현되어야 하는 것.
                - 이미 추천 또는 비추천했을 경우
                    - 추천의 경우
                        - 추천을 눌렀을때 추천 취소
                        - 비추천을 눌렀을떄 기존 추천을 취소하고 비추천
                    - 비추천의 경우
                        - 추천을 눌렀을때 기존 비추천을 취소하고 추천
                        - 비추천을 눌럿을 경우 기존 비추천만 취소
                - relId (게시글 번호), memberId(회원번호), point(추천, 비추천)
                
- article 테이블에 추천수 담는 컬럼 추가
- 추천 내역 업데이트
- 글 조회 할때 쿼리를 단축
- reactionPoint 서비스, 리포지토리 생성
    - 좋아요, 싫어요 기능 분리

## 2022.10.27
- 댓글 기능 구현
    - 댓글 테이블 하나 필요
    - id, date, update, relId, memberId, comment article 테이블과 비슷..
    - 종속적인면이 있다. 댓글, 좋,실어요 모두 외래키로 해서 글이 삭제되면 삭제시킬 수 있는게 좋을듯하다.

- 조회수는 수정이 필요
        - article에 hit 가 빠져있었음
        - 메인페이지에 들어가면 localStorage 가 초기화 되도록 해서 조회수를 다시 올릴 수 있도록 했음

- DB 쿼리문 정리
    - 데이터 생성, 테스트데이터 생성, 연습쿼리 등으로 구분

- 좋아요 싫어요 테이블에 cascade 를 적용
    - 글 삭제시 좋아요 싫어요 튜플도 삭제 정상작동함
    - FOREIGN KEY (relId) REFERENCES article(id) ON DELETE CASCADE


## 2022.10.28

- 문제점..
    - 데이터가 없으면 값이 아예 나오지 않음...
    - 업데이트가 되지않는다는 문제..
    - 또, 모든 튜플을 업데이트할 필요는 없다..
    - 하나의 개시글만 지정해서 하면 됨.. 
    - 먼저 굿포인트 배드포인트 추려야함
    - is null 이면 0 으로 하는것도 해야함.
    - 데이터를 유지하는것. 또 리엑션에 업데이트가 있다는것은
    - 데이터를 삭제해버리는것이 아니라 update 를 해서 -1,0,1 로 업데이트
    - select from where group by 로 해서 특정 relId 만 가져와서 업데이트 하도록 한다.

    - 조건식에서 빠져나가는것들이 있어서 알고리즘을 다시 짜야된다.
    - case1
        - 회원이 아직 아무런 리액션을 하지 않은 경우
            - reactionRd 의 상태는 null 이거나 0 이된다.
            - 이 경우에는 point 값을 그대로 넘겨서 리엑션에 업데이트 또는 생성 해줘야 함.
            - null 일때는 생성
            - 0 일때는 업데이트
    - case2
        - 회원이 좋아요를 눌른 상태에서의 경우
            - 좋아요를 누른다면 0으로 업데이트
            - 싫어요를 누른다면 -1로 업데이트
    - case3
        - 회원이 싫어요 누른 상태에서의 경우
            - 이것도 그냥 1 또는 0으로 업데이트
            - 좋아요는 1로
            - 싫어요는 0으로
- 쿼리스트링으로 치고 들어오는것 방어 해야함.
    - 무조건 값 비교해서 실행하는것이 아니라 검증 필요함
    - 잘못된 접근이라고 경고주고 막아버리자
    - 잘못된 접근의 예
        - relId 와 point 를 파라미터로 받기때문에 두가지의 경우만 막는다.
        - relId 는 없으면 그런 개시물 없다고 해야함
        - point 는 1, -1 이 아니면 잘못된 접근이라고 하고 쫒아내야함.
        - memberId 는 needLoginInterceptor 에서 로그인하라고 하기때문에 괜찮음
        - 입력값이 없을 경우 또한 잘못된 접근입니다 라고 하자.

- 댓글작성
    - 리스트와 비슷한 형식으로
    - 개시글번호를 파라미터로 해당되는 댓글을 리스트로 불러와서 반복문으로 출력
    - 작성 폼은 글 작성하는 폼 하나 넣고 개시글 번호를 같이 보내야 하기 때문에 input hidden 추가


## 2022.10.30
- ajax 이용을 위한 코드 분석
```java
<script>
	const params = {};
	params.id = parseInt('${param.id}');
</script>

<script>
	function ArticleDetail__increaseHitCount() {
		const localStorageKey = 'article__' + params.id + '__alreadyView';
		if (localStorage.getItem(localStorageKey)) {
			return;
		}
		localStorage.setItem(localStorageKey, true);
		$.get('../article/incresedHit', {
			id : params.id,
			ajaxMode : 'Y'
		}, function(data) {
			$('.article-detail__hit').empty().html(data.data1);
		}, 'json');
	}
	$(function() {
		// 실전코드
		//ArticleDetail__increaseHitCount();
		// 연습코드
		setTimeout(ArticleDetail__increaseHitCount, 2000);
	})
</script>
```
- 조회수를 새로고침 해주는 ajax 함수
- 변수 선언
    - params = {id: 파라미터로 받은 id 값 }
- 자바스크립트 함수 선언
    - 로컬스토리지키 설정
    - 조건문 만약 로컬스토리지에서 같은 키를 발견하면 그냥리턴
    - 아닌경우에 밑으로 진행
    - 로컬스토리지에 셋아이템 키, 벨류
    - 제이쿼리 $get 서버에 HTTP request 보냄
    - ,{id, ajaxMode } 로 필요한 데이터 같이 보냄
    - , function(data) 로 데이터 가져옴
    - 실행함수는 setTimeout 함수에 넣어서 2000ms 뒤에 실행되도록 설정
```js
<script>
    $(function() {
        $("#requestBtn").on("click", function() {
            $.get("URL주소"), // GET 방식으로 서버에 HTTP Request를 보냄.
                { species: "강아지", name: "양하얀", age: 13}, // 서버가 필요한 정보를 같이 보냄.
                function(data, status) {
                    $("#text").html(data + "<br>" + status); // 전송받은 데이터와 전송 성공 여부를 보여줌.
                }
        })
    })
</script>

<h1>$.get() 메소드</h1>
<button id="requestBtn">GET 방식으로 데이터 불러오기!</button>
<p id="text"></p>
```
    - 예시코드

- 적용해야하는것
    - onclick 시에 Url에 데이터 전송, 실행 후 데이터 가져와서 코드값이 변경되도록한다.
    - 좋아요 싫어요 에 함수를 넣는다.
    - 요청 Url = ../reaction/doReaction
    - 보내야 하는 값 relId 와 point
    - 받아와야하는 값 로그인한 회원의 추천여부, 좋아요,싫어요 총 갯수.
    - controller에서 실행코드를 확인해본다.
```java
	@RequestMapping("/usr/article/incresedHit")
	@ResponseBody
	public ResultData<Integer> incresedHit(int id) {
		ResultData<Integer> incresedHitRd = articleService.increseHit(id);

		if (incresedHitRd.isFail()) {
			return incresedHitRd;
		}
		ResultData<Integer> rd = ResultData.newData(incresedHitRd, "hitCount", articleService.getArticleHitCount(id));
		rd.setData2("id", id);
		
		return rd;

	}
```
    - 받아오는 값 id 
    - ResultData 를 리턴
    - 데이터 가져올때 rd 값으로 보낸걸 console.log 로 확인해보자
```json
{resultCode: 'S-1', msg: '게시물 조회수 증가', data1: 1, data1Name: 'hitCount', data2: 2, …}
data1
: 
1
data1Name
: 
"hitCount"
data2
: 
2
data2Name
: 
"id"
fail
: 
false
msg
: 
"게시물 조회수 증가"
resultCode
: 
"S-1"
success
: 
true
[[Prototype]]
: 
Object
```
    - 사용할때 data.data1 로 사용한것은 hitcount 를 받아온것.
    - ajax 통신을 할때 사용하는 포맷 json, xml json은 xml을 대체한다. 
```js
<button id="click">Click Me</button>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script>
  function hello() {
    console.log('hello')
    console.log('bye')
  }
  $('#click').click(hello);
</script>
/**
 * 자바스크립트 실행
 */
<button onclick="myFunction()">Click me</button>

/**
 * 클릭하면 빨간색
 */
<p id="demo" onclick="myFunction()">Click me to change my text color.</p>

<script>
function myFunction() {
  document.getElementById("demo").style.color = "red";
}
</script>
/**
 * 클릭하면 빨간색2
 */
<p onclick="myFunction(this, 'red')">Click me to change my text color.</p>

<script>
function myFunction(elmnt,clr) {
  elmnt.style.color = clr;
}
</script>
```
- onclick 이벤트 적용
- alert(""); 값도 rd 로 보낼 수 있고,
- 필요한 값은 rd data1로 지정해서 보내는걸로 하면됨

## 2022.10.31
- 로그인폼 만들기

- 비동기 계속 시도해보기
    - 비동기로 조회수를 조작하는건 가능

- rq 객체를 불러오게 하고 안에 데이터를 3가지 넣는다.
- 받는 것. relId , point
- 가지고있는것. loginmemberId
- 확인해야하는것. 로그인한사람이 리엑션을 어떤걸 했나 안했나 취소했나
- 종류는 2가지 리엑션을 바꿔주는거, 새로만들어주는것.
- 작동은 똑같다. 바꿔주는것은 changeReaction , 새로만든것은 doReaction 으로 하고
- 맴버가 한 리엑션 불러오는것. getReactionResult
- 내보내는 rd ( rd(실행결과), 맴버의행동결과, point , 전체좋아요, point, 전체 싫어요 , point )
- 좋아요와 싫어요를 가져오는것 필요.

- 해야할것
    - 좋아요 싫어요 표시
    - 강의내용 적용하기

## 2022.11.1
- 가져온 값을 이용해서 색상도 변경해보기
- 클래스를 적용? 
- 찾아보자
```js
const ArticleDetail__goodReactionPoint = () =>{
	$.get('../reaction/doReaction',{
		relId : ${article.id},
		point : 1,
		ajaxMode : 'Y'
	}, function(data){
		$('.article-detail__Reaction').empty().html(data.data1);
		$('.article-detail__goodReaction').empty().html(data.data2);
		$('.article-detail__badReaction').empty().html(data.data3);
		if(reaction == -1 || reaction == 0){
			reaction = 1;
		}else if(reaction == 1 ){
			reaction = 0;
		}
		console.log(data);
		console.log(reaction);
		reactionPick();
	}, 'json');
}
```
- 테두리를 조작하자
- 처음 실행으로 reaction 에따라 테두리 적용
- 다음 눌럿을때 
    -  1 되고 좋아요에 글색 빨간색, 싫어요는 검은색
    - -1 되고 좋아요는 검은색 싫어요는 빨간색
    -  0 이면 둘다 검은색
- $(".goodReaction").css("color","black"); 제이쿼리로 글자색 변경

- 댓글 삭제 구현
    - 댓글 기능 전체를 비동기로 구현하면 좋겠지만 먼저 기능구현부터 하자
    - 댓글 id 는 기본키 , id 값만 가져오면 삭제가 가능하다.
    - 로그인 맴버와 작성자가 같아야만 삭제 버튼이 보이도록 구현
    ```jsp
    <c:if test="${rq.loginedMemberId eq comment.memberId}">
		<button class="comment-modify-btn">수정</button>
		<button class="comment-delete-btn">삭제</button>
	</c:if>
    ```
    - onclick 으로 id 값을 보내준다.
    - 처리 결과는 비동기로 전환 했을때를 염두에 두고 rq 데이터를 만들어놓고 지금은 새로고침하는 걸로 사용한다.
    - 새로고침 할때 가야되는 글의 번호를 가져와야 한다.
    - relId 를 보내줘서 새로고침할때의 글 번호로 지정.

- 댓글 생성 제한
    - 2글자 이상 입력해야 하는 조건
    ```js
    	let CommentWrite__submitFormDone = false;
	
	function CommentWrite__submitForm(form){
		
		if(CommentWrite__submitFormDone){
			return;
		}
		form.comment.value = form.comment.value.trim();
		
		if (form.comment.value.length < 2) {
			alert('2글자 이상 입력해주세요');
			form.comment.focus();
			return;
		}
		
		CommentWrite__submitFormDone = true;
		form.submit();
	}
    ```
    ```jsp
    <form action="../comment/doAdd?" method="post" onsubmit="CommentWrite__submitForm(this); return false;">
    ```
- 데이터베이스 인덱스 설정
    - 데이터베이스 조회시에 조건에 따라 검색범위를 좁혀서 불필요한 데이터 검색을 방지
    - relId 별로 댓글이 구분되기때문에 index를 해주면 되겠다.
    - ALTER TABLE `SB_AM`.`comment` ADD INDEX (`relTypeCode` , `relId`); 
        - 순차적으로 조회
- 게시글의 개행문자 처리
    - String setBody = body.replaceAll("\r\n", "<br>");
    - 개행부분을 <br> 로 치환해줘서 저장


- 데이터 연습 bigData
    - 케글

- 댓글 수정
    - 폼 구현
        - 수정 버튼 클릭했을때 jquery 로 input type text 로 value 값을 변경
        - form 으로 감싸서 수정버튼으로 submit 하면 수정될수 있도록 하는게..될려나

- 댓글 번호 출력시 id 값이 아닌 해당 게시물에 댓글의 순번이 나올 수 있도록
    - foreach 에서 설정
    - varStatus = "Status"
    - ${status.count}
    ```js
    ${status.current} 현재 for문의 해당하는 번호
    ${status.index} 0부터의 순서
    ${status.count} 1부터의 순서
    ${status.first} 첫 번째인지 여부
    ${status.last} 마지막인지 여부
    ${status.begin} for문의 시작 번호
    ${status.end} for문의 끝 번호
    ${status.step} for문의 증가값
    ```

## 2022.11.02
- 반복문으로 생성한 댓글 목록으로는 수정 폼을 특정하기가 힘들다.
- 폼은 좀더 고민해보고 기능구현부터 우선
- 댓글 수정 시 필요한것
    - 게시물 id
    - 댓글 id
    - 새로고치는 comment 내용
- 컨트롤러, 서비스, 리포지토리 추가
    - 테스트 결과 성공

- 폼 구현 
    - 수정 버튼 클릭 시 해당 글에 폼을 삽입 해야된다.
    - html()로 창을 넣는것은 확인할수있었지만 필요한것은 특정클래스를 검색하는것이 아닌 클릭한 버튼의 형제 엘리먼트를 선택해서 적용 해야된다는 점.
    - 댓글에 번호를 붙여주는 ${status.count} 를 이용해서 클래스를 다르게 선언해주고 값을 함수로 전달해서
    ```js
    const modifyBtn = (count,id,relId,comment) => {
	const commentBox = ".comment" + count;
	const commentControllBox = ".comment-controll-box"+ count;
	var ModifyForm = "<form action='../comment/doModify?' method='post'>";
		ModifyForm +=	"<input type='hidden' value='"+ id +"' name='id'/>";
		ModifyForm += "<input type='hidden' value='" + relId + "' name='relId'/>";
		ModifyForm += "<input type='text' id='comment' name='comment' class='h-6 w-auto' value='"+comment+"'required/>";
		ModifyForm += "<button class='comment-modify-btn' type='submit'>수정</button></form>";
		$(commentBox).html(ModifyForm);
		$(commentControllBox).empty();
    }
    ```
    - commentBox 엘리먼트를 특정했다
    - from 을 집어넣고 보여주도록 삽입
    - ${comment.comment} 를 변수로 받으려고 했지만 숫자는 전달이 됬지만 문자열은 전달이 되지않아 여러가지를 시도했다. 답은 '${comment.comment}' 이렇게 보내야함.
    - 수정 폼 안에 이전 작성글을 넣을 수 있었다. 

- 회원번호 수정
    - 2단계인증
- SHA